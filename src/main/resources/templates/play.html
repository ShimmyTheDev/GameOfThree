<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Play - Shimmy's Game Of Three</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <style>
        body {
            background-color: #181a1b;
            color: #f8f9fa;
        }
        .hero {
            min-height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .btn-play {
            font-size: 1.5rem;
            padding: 0.75rem 2rem;
        }
        .links {
            margin-top: 2rem;
        }
        .links a {
            color: #f8f9fa;
            text-decoration: none;
            margin: 0 1rem;
            font-size: 1.1rem;
        }
        .links a:hover {
            text-decoration: underline;
            color: #0d6efd;
        }
    </style>
</head>
<body class="bg-dark text-light">
<div class="container">
    <div class="hero text-center">
        <h1 class="display-4 fw-bold mb-4">Game Of Three</h1>
        <p class="lead mb-4">A simple, fun, and strategic game for two players. Try to reach 1!</p>
        <form id="matchmakingForm" class="mb-4">
            <div class="mb-3">
                <input type="text" class="form-control form-control-lg" id="playerName" name="playerName"
                       placeholder="Enter your name" required>
            </div>
            <button type="submit"
                    id="findGameBtn"
                    class="btn btn-primary btn-play w-100"
                    hx-trigger="click"
                    hx-target="#findGameBtn"
                    hx-swap="outerHTML"
                    hx-indicator="#loadingIcon"
                    hx-disable-elt="#playerName, #findGameBtn">
                <span id="findGameText">Find Game</span>
                <span id="loadingIcon" class="spinner-border spinner-border-sm d-none" role="status"
                      aria-hidden="true"></span>
            </button>
        </form>
        <div class="links">
            <a href="/rules">Rules</a>
            <a href="https://github.com/shimmy/game-of-three" target="_blank">GitHub</a>
        </div>
    </div>
</div>
<div id="matchmaking-status"></div>
<script>
    // Redirect to game.html if playerId exists in localStorage
    if (localStorage.getItem('playerId')) {
        window.location.href = '/game.html';
    }

    document.getElementById('matchmakingForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const playerName = document.getElementById('playerName').value;
        fetch('/api/player/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'playerName=' + encodeURIComponent(playerName)
        })
        .then(response => response.json())
        .then(data => {
            localStorage.setItem('playerId', data.playerId);
            window.location.href = '/game';
        })
        .catch(error => {
            console.error('Error creating player:', error);
            alert('Error creating player. Please try again.');
        });
    });
</script>
</body>
</html>
